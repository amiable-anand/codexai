@startuml CodexAI Class Diagram

' CLI Tool Classes
package "CLI Tool" {
    class CodebaseUploader {
        +storage_connection_string: str
        +container_name: str
        +__init__(connection_string: str)
        +zip_codebase(directory_path: str, output_path: str, gitignore_path: str): str
        +upload_to_blob(zip_path: str, blob_name: str): dict
        +filter_files(directory_path: str, gitignore_path: str): list[str]
    }
    
    class GitignoreParser {
        +patterns: list[str]
        +__init__(gitignore_path: str)
        +should_ignore(file_path: str): bool
        +parse_gitignore(): list[str]
    }
    
    CodebaseUploader --> GitignoreParser
}

' Azure Functions Classes
package "Azure Functions" {
    class BlobUploadTrigger {
        +cosmos_client: CosmosClient
        +__init__()
        +handle_blob_upload(blob: BlobClient): dict
        +extract_metadata(blob_name: str): dict
    }
    
    class IngestionFunction {
        +openai_client: AzureOpenAI
        +search_client: SearchClient
        +cosmos_client: CosmosClient
        +chunk_size: int
        +overlap: int
        +__init__()
        +process_codebase(blob_name: str): dict
        +chunk_code(file_content: str, file_type: str): list[CodeChunk]
        +generate_embeddings(chunks: list[CodeChunk]): list[float]
        +index_chunks(chunks: list[CodeChunk], embeddings: list[float]): bool
        +store_metadata(project_id: str, metadata: dict): bool
    }
    
    class RAGInferenceFunction {
        +openai_client: AzureOpenAI
        +search_client: SearchClient
        +cosmos_client: CosmosClient
        +max_context_tokens: int
        +__init__()
        +generate_documentation(file_path: str, project_id: str, doc_type: str): str
        +retrieve_context(query: str, top_k: int): list[SearchResult]
        +build_prompt(file_content: str, context: list[SearchResult], doc_type: str): str
        +call_llm(prompt: str): str
        +save_documentation(project_id: str, file_path: str, content: str): bool
    }
    
    class APIGatewayFunction {
        +cosmos_client: CosmosClient
        +rag_function: RAGInferenceFunction
        +__init__()
        +list_projects(user_id: str): list[dict]
        +get_project_files(project_id: str): list[dict]
        +trigger_doc_generation(request: DocGenerationRequest): dict
        +get_documentation(project_id: str, file_path: str): str
    }
}

' Data Models
package "Data Models" {
    class CodeChunk {
        +chunk_id: str
        +project_id: str
        +file_path: str
        +content: str
        +start_line: int
        +end_line: int
        +chunk_type: str
        +language: str
        +embedding: list[float]
        +metadata: dict
    }
    
    class Project {
        +id: str
        +user_id: str
        +name: str
        +upload_timestamp: datetime
        +blob_name: str
        +status: str
        +file_count: int
        +total_size: int
        +metadata: dict
    }
    
    class FileMetadata {
        +id: str
        +project_id: str
        +file_path: str
        +language: str
        +size: int
        +chunk_count: int
        +has_documentation: bool
        +last_updated: datetime
    }
    
    class Documentation {
        +id: str
        +project_id: str
        +file_path: str
        +content: str
        +doc_type: str
        +generated_at: datetime
        +token_count: int
        +cost: float
    }
    
    class SearchResult {
        +chunk_id: str
        +file_path: str
        +content: str
        +score: float
        +metadata: dict
    }
    
    class DocGenerationRequest {
        +project_id: str
        +file_path: str
        +doc_type: str
        +include_tests: bool
        +include_dependencies: bool
    }
}

' Service Interfaces
package "Service Interfaces" {
    interface IStorageService {
        +upload_blob(data: bytes, blob_name: str): str
        +download_blob(blob_name: str): bytes
        +list_blobs(prefix: str): list[str]
        +delete_blob(blob_name: str): bool
    }
    
    interface IEmbeddingService {
        +generate_embedding(text: str): list[float]
        +generate_batch_embeddings(texts: list[str]): list[list[float]]
    }
    
    interface IVectorSearchService {
        +index_document(document: CodeChunk): bool
        +search(query_vector: list[float], top_k: int, filters: dict): list[SearchResult]
        +hybrid_search(query_text: str, query_vector: list[float], top_k: int): list[SearchResult]
    }
    
    interface IMetadataService {
        +create_project(project: Project): str
        +get_project(project_id: str): Project
        +update_project_status(project_id: str, status: str): bool
        +create_file_metadata(file_metadata: FileMetadata): str
        +get_files_by_project(project_id: str): list[FileMetadata]
        +save_documentation(documentation: Documentation): str
        +get_documentation(project_id: str, file_path: str): Documentation
    }
    
    interface ILLMService {
        +generate_completion(prompt: str, max_tokens: int, temperature: float): str
        +count_tokens(text: str): int
    }
}

' Frontend Classes
package "Frontend (React)" {
    class ProjectService {
        +api_base_url: str
        +__init__(base_url: str)
        +fetchProjects(): Promise<Project[]>
        +fetchProjectFiles(projectId: string): Promise<FileMetadata[]>
        +generateDocumentation(request: DocGenerationRequest): Promise<Documentation>
        +getDocumentation(projectId: string, filePath: string): Promise<string>
    }
    
    class FileExplorer {
        +projects: Project[]
        +selectedProject: Project
        +files: FileMetadata[]
        +loadProjects(): void
        +selectProject(projectId: string): void
        +loadFiles(projectId: string): void
        +renderFileTree(): JSX.Element
    }
    
    class DocumentationViewer {
        +documentation: string
        +isLoading: bool
        +error: string
        +loadDocumentation(projectId: string, filePath: string): void
        +renderMarkdown(content: string): JSX.Element
    }
}

' Relationships
IngestionFunction --> IStorageService
IngestionFunction --> IEmbeddingService
IngestionFunction --> IVectorSearchService
IngestionFunction --> IMetadataService

RAGInferenceFunction --> IVectorSearchService
RAGInferenceFunction --> IMetadataService
RAGInferenceFunction --> ILLMService

APIGatewayFunction --> IMetadataService
APIGatewayFunction --> RAGInferenceFunction

ProjectService --> APIGatewayFunction : HTTP requests
FileExplorer --> ProjectService
DocumentationViewer --> ProjectService

BlobUploadTrigger --> IngestionFunction : triggers

CodeChunk --> FileMetadata
FileMetadata --> Project
Documentation --> Project

@enduml